# Mimamsa Backend - Render Manual Deployment Guide

## Prerequisites
- GitHub account with backend repository pushed
- Render account (free tier works)
- Cloudinary account with credentials

## Deployment Steps

### 1. Push Code to GitHub
```bash
cd backend
git add .
git commit -m "Add Render deployment configuration"
git push origin main
```

### 2. Create PostgreSQL Database on Render
1. Go to https://dashboard.render.com
2. Click "New +" → "PostgreSQL"
3. Configure:
   - Name: `mimamsa-db`
   - Database: `mimamsa`
   - User: `mimamsa`
   - Region: Choose closest to you (Singapore for India)
   - Plan: Free
4. Click "Create Database"
5. Wait for database to be ready (2-3 minutes)
6. Copy the "Internal Database URL" (starts with `postgresql://`)

### 3. Create Web Service on Render
1. Click "New +" → "Web Service"
2. Connect your GitHub repository: `MimamsaBackend`
3. Configure:
   - **Name**: `mimamsa-backend`
   - **Region**: Same as database
   - **Branch**: `main`
   - **Root Directory**: Leave empty
   - **Runtime**: `Python 3`
   - **Build Command**: 
     ```
     pip install -r requirements.txt && python manage.py collectstatic --no-input && python manage.py migrate
     ```
   - **Start Command**: 
     ```
     gunicorn backend.wsgi:application
     ```
   - **Plan**: Free

### 4. Add Environment Variables
In the "Environment" section, add:

```
SECRET_KEY = (Auto-generated by Render or use your own)
DEBUG = False
ALLOWED_HOSTS = your-app-name.onrender.com
DATABASE_URL = (Link to mimamsa-db database)
CLOUDINARY_CLOUD_NAME = your_cloud_name
CLOUDINARY_API_KEY = your_api_key
CLOUDINARY_API_SECRET = your_api_secret
```

**Important**: 
- For `DATABASE_URL`, click "Add from Database" and select `mimamsa-db`
- Get Cloudinary credentials from your Cloudinary dashboard

### 5. Deploy
1. Click "Create Web Service"
2. Render will automatically:
   - Install dependencies from requirements.txt
   - Run collectstatic
   - Run migrations
   - Start gunicorn server
3. Wait for deployment to complete (5-10 minutes)
4. Your API will be live at: `https://your-app-name.onrender.com`

### 6. Update Frontend
Update `punch/.env` with your Render URL:
```
API_BASE_URL=https://your-app-name.onrender.com
```

## Testing Deployment
Test these endpoints:
- `https://your-app-name.onrender.com/api/books/`
- `https://your-app-name.onrender.com/api/authors/`
- `https://your-app-name.onrender.com/api/categories/`

## Troubleshooting

### Build Fails
- Check build logs in Render dashboard
- Ensure all dependencies are in requirements.txt
- Verify build.sh has execute permissions

### Database Connection Issues
- Verify DATABASE_URL is correctly linked
- Check database is in same region as web service
- Ensure migrations ran successfully

### Static Files Not Loading
- Check STATIC_ROOT and STATIC_URL in settings.py
- Verify WhiteNoise is in MIDDLEWARE
- Run `python manage.py collectstatic` manually if needed

### CORS Errors
- Add your Render URL to ALLOWED_HOSTS
- Verify CORS_ALLOW_ALL_ORIGINS is True (or configure specific origins)

## Free Tier Limitations
- Service spins down after 15 minutes of inactivity
- First request after spin-down takes 30-60 seconds
- 750 hours/month free (enough for one service)
- Database: 1GB storage, 97 hours/month free

## Upgrading to Paid Plan
For production use, consider:
- Starter plan ($7/month) - No spin-down
- Database plan ($7/month) - Always on
- Better performance and reliability

## Local Development
To run locally with same configuration:
```bash
# Activate virtual environment
env\Scripts\activate

# Run migrations
python manage.py migrate

# Start server
python manage.py runserver 0.0.0.0:8000
```

## Support
- Render Docs: https://render.com/docs
- Django Deployment: https://docs.djangoproject.com/en/5.2/howto/deployment/
